/*
 * ngComboDatePicker v1.2.0
 * http://github.com/jfmdev/ngComboDatePicker
 * «Copyright 2015 Jose F. Maldonado»
 * License: LGPLv3 (http://www.gnu.org/licenses/lgpl-3.0.html)
 */
angular.module("ngComboDatePicker",[]).directive("ngComboDatePicker",function(){return{restrict:"AEC",scope:{ngModel:"=",ngDate:"@",ngMinDate:"@",ngMaxDate:"@",ngMonths:"@",ngOrder:"@",ngAttrsDate:"@",ngAttrsMonth:"@",ngAttrsYear:"@",ngYearOrder:"@",ngTimezone:"@"},controller:["$scope",function(e){function n(e,n){var a=null;return void 0!==e&&null!==e&&(e instanceof Date?a=e:("number"==typeof e||"string"==typeof e)&&(a=new Date(isNaN(e)?e:parseInt(e,10)),a=t(a,n))),a}function t(e,n){var t=isNaN(n)?(new Date).getTimezoneOffset():60*parseFloat(n);return new Date(e.getTime()+60*t*1e3)}function a(e,n){var t=31;return null!=e&&((4==e||6==e||9==e||11==e)&&(t=30),null!=n&&2==e&&(t=n%4==0&&n%100!=0?29:28)),t}function l(e){var n=null;if(null!=e){try{n=JSON.parse(e)}catch(t){}if(null==n)try{n=JSON.parse(e.replace(/'/g,'"'))}catch(t){}}return n}e.ngModel=n(e.ngModel,e.ngTimezone),e.ngAttrsDate=l(e.ngAttrsDate),e.ngAttrsMonth=l(e.ngAttrsMonth),e.ngAttrsYear=l(e.ngAttrsYear);var g=n(e.ngDate,e.ngTimezone);if(null!=g&&(e.ngModel=g),"string"!=typeof e.ngOrder?e.ngOrder="dmy":e.ngOrder=e.ngOrder.toLowerCase(),e.minDate=n(e.ngMinDate,e.ngTimezone),null==e.ngMinDate){var o=t(new Date,e.ngTimezone);e.minDate=new Date(o.getFullYear()-100,o.getMonth(),o.getDate(),o.getHours(),o.getMinutes(),o.getSeconds(),o.getMilliseconds())}e.maxDate=n(e.ngMaxDate,e.ngTimezone),null==e.maxDate&&(e.maxDate=t(new Date,e.ngTimezone)),e.ngModel<e.minDate&&(e.ngModel=e.minDate),e.ngModel>e.maxDate&&(e.ngModel=e.maxDate),e.years=[];for(var r=e.minDate.getFullYear();r<=e.maxDate.getFullYear();r++)e.years.push(r);"string"==typeof e.ngYearOrder&&0==e.ngYearOrder.indexOf("des")&&e.years.reverse();var d=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];if(void 0!==e.ngMonths&&null!==e.ngMonths){if("string"==typeof e.ngMonths){var u=e.ngMonths.split(",");12==u.length&&(d=u)}Array.isArray(e.ngMonths)&&12==e.ngMonths.length&&(d=e.ngMonths)}e.updateMonthList=function(){var n=null!=e.ngModel&&e.ngModel.getFullYear()==e.minDate.getFullYear()?e.minDate.getMonth():0,t=null!=e.ngModel&&e.ngModel.getFullYear()==e.maxDate.getFullYear()?e.maxDate.getMonth():11;e.months=[];for(var a=n;t>=a;a++)e.months.push({index:a,name:d[a]})},e.updateDateList=function(){var n=1;null!=e.ngModel&&e.ngModel.getMonth()==e.minDate.getMonth()&&e.ngModel.getFullYear()==e.minDate.getFullYear()&&(n=e.minDate.getDate());var t=null!=e.ngModel?a(e.ngModel.getMonth()+1,e.ngModel.getFullYear()):a(null,null);null!=e.ngModel&&e.ngModel.getMonth()==e.maxDate.getMonth()&&e.ngModel.getFullYear()==e.maxDate.getFullYear()&&(t=e.maxDate.getDate()),e.dates=[];for(var l=n;t>=l;l++)e.dates.push(l)},e.modelUpdated=function(){e.date=null!=e.ngModel?e.ngModel.getDate():null,e.month=null!=e.ngModel?e.ngModel.getMonth():null,e.year=null!=e.ngModel?e.ngModel.getFullYear():null,e.updateMonthList(),e.updateDateList()},e.$watch("ngModel",function(){e.modelUpdated()}),e.onChange=function(n){if(null!=e.date&&null!=e.month&&null!=e.year){var t=a(e.month+1,e.year),l=0,g=0,o=0,r=0;null!=e.ngModel&&(l=e.ngModel.getHours(),g=e.ngModel.getMinutes(),o=e.ngModel.getSeconds(),r=e.ngModel.getMilliseconds()),e.ngModel=new Date(e.year,e.month,e.date>t?t:e.date,l,g,o,r)}e.updateMonthList(),e.updateDateList()},e.getSomething=function(){return"color:red;"}}],link:function(e,n,t){var a=angular.element,l=a(n[0]).children(),g=e.ngOrder.split("");null!=e.ngAttrsDate&&a(l[0]).attr(e.ngAttrsDate),null!=e.ngAttrsMonth&&a(l[1]).attr(e.ngAttrsMonth),null!=e.ngAttrsYear&&a(l[2]).attr(e.ngAttrsYear);for(var o=0;o<g.length;o++)"d"==g[o]&&a(n[0]).append(l[0]),"m"==g[o]&&a(n[0]).append(l[1]),"y"==g[o]&&a(n[0]).append(l[2])},template:function(){var e='<select ng-model="date" ng-change="onChange(\'date\')" ng-options="date for date in dates"></select><select ng-model="month" ng-change="onChange(\'month\')" ng-options="month.index as month.name for month in months"></select><select ng-model="year" ng-change="onChange(\'year\')" ng-options="year for year in years"></select>';return e}}});
